var ep = window.ep || {}; ep.bundles = ep.bundles || []; ep.bundles = ep.bundles.concat('bundled/buzzsessionsync.js','buzz/session.ehost.js', 'ep/util/buzzsessionsync.js', 'ep/authentication-aspect.js');
var requirejs,require,define;(function(J){var G,N,C,B,K={},L={},v={},y={},D=Object.prototype.hasOwnProperty,F=[].slice,E=/\.js$/;function u(b,a){return D.call(b,a)}function A(h,l){var o,c,e,b,n,f,j,g,p,a,d,k=l&&l.split("/"),i=v.map,m=(i&&i["*"])||{};if(h&&h.charAt(0)==="."){if(l){k=k.slice(0,k.length-1);h=h.split("/");n=h.length-1;if(v.nodeIdCompat&&E.test(h[n])){h[n]=h[n].replace(E,"")}h=k.concat(h);for(p=0;p<h.length;p+=1){d=h[p];if(d==="."){h.splice(p,1);p-=1}else{if(d===".."){if(p===1&&(h[2]===".."||h[0]==="..")){break}else{if(p>0){h.splice(p-1,2);p-=2}}}}}h=h.join("/")}else{if(h.indexOf("./")===0){h=h.substring(2)}}}if((k||m)&&i){o=h.split("/");for(p=o.length;p>0;p-=1){c=o.slice(0,p).join("/");if(k){for(a=k.length;a>0;a-=1){e=i[k.slice(0,a).join("/")];if(e){e=e[c];if(e){b=e;f=p;break}}}}if(b){break}if(!j&&m&&m[c]){j=m[c];g=p}}if(!b&&j){b=j;f=g}if(b){o.splice(0,f,b);h=o.join("/")}}return h}function w(b,a){return function(){return N.apply(J,F.call(arguments,0).concat([b,a]))}}function z(a){return function(b){return A(b,a)}}function I(a){return function(b){K[a]=b}}function H(a){if(u(L,a)){var b=L[a];delete L[a];y[a]=true;G.apply(J,b)}if(!u(K,a)&&!u(y,a)){throw new Error("No "+a)}return K[a]}function x(b){var a,c=b?b.indexOf("!"):-1;if(c>-1){a=b.substring(0,c);b=b.substring(c+1,b.length)}return[a,b]}C=function(c,d){var b,e=x(c),a=e[0];c=e[1];if(a){a=A(a,d);b=H(a)}if(a){if(b&&b.normalize){c=b.normalize(c,z(d))}else{c=A(c,d)}}else{c=A(c,d);e=x(c);a=e[0];c=e[1];if(a){b=H(a)}}return{f:a?a+"!"+c:c,n:c,pr:a,p:b}};function M(a){return function(){return(v&&v.config&&v.config[a])||{}}}B={require:function(a){return w(a)},exports:function(b){var a=K[b];if(typeof a!=="undefined"){return a}else{return(K[b]={})}},module:function(a){return{id:a,uri:"",exports:K[a],config:M(a)}}};G=function(i,k,l,a){var f,b,e,j,g,d=[],h=typeof l,c;a=a||i;if(h==="undefined"||h==="function"){k=!k.length&&l.length?["require","exports","module"]:k;for(g=0;g<k.length;g+=1){j=C(k[g],a);b=j.f;if(b==="require"){d[g]=B.require(i)}else{if(b==="exports"){d[g]=B.exports(i);c=true}else{if(b==="module"){f=d[g]=B.module(i)}else{if(u(K,b)||u(L,b)||u(y,b)){d[g]=H(b)}else{if(j.p){j.p.load(j.n,w(a,true),I(b),{});d[g]=K[b]}else{throw new Error(i+" missing "+b)}}}}}}e=l?l.apply(K[i],d):undefined;if(i){if(f&&f.exports!==J&&f.exports!==K[i]){K[i]=f.exports}else{if(e!==J||!c){K[i]=e}}}}else{if(i){K[i]=l}}};requirejs=require=N=function(a,e,d,c,b){if(typeof a==="string"){if(B[a]){return B[a](e)}return H(C(a,e).f)}else{if(!a.splice){v=a;if(v.deps){N(v.deps,v.callback)}if(!e){return}if(e.splice){a=e;e=d;d=null}else{a=J}}}e=e||function(){};if(typeof d==="function"){d=c;c=b}if(c){G(J,a,e,d)}else{setTimeout(function(){G(J,a,e,d)},4)}return N};N.config=function(a){return N(a)};requirejs._defined=K;define=function(c,b,a){if(!b.splice){a=b;b=[]}if(!u(K,c)&&!u(L,c)){L[c]=[c,b,a]}};define.amd={jQuery:true}}());define("vendor/almond/almond",function(){});define("underscore",["underscore"],function(){return _});define("jquery",["jquery"],function(){return jQuery});(function(e,d){if(typeof define==="function"&&define.amd){define("backbone",["underscore","jquery","exports"],function(b,a,c){e.Backbone=d(e,c,b,a)})}else{if(typeof exports!=="undefined"){var f=require("underscore");d(e,exports,f)}else{e.Backbone=d(e,{},e._,(e.jQuery||e.Zepto||e.ender||e.$))}}}(this,function(af,Z,N,ab){var X=af.Backbone;var au=[];var V=au.push;var al=au.slice;var ag=au.splice;Z.VERSION="1.1.2";Z.$=ab;Z.noConflict=function(){af.Backbone=X;return this};Z.emulateHTTP=false;Z.emulateJSON=false;var P=Z.Events={on:function(d,a,b){if(!ac(this,"on",d,[a,b])||!a){return this}this._events||(this._events={});var c=this._events[d]||(this._events[d]=[]);c.push({callback:a,context:b,ctx:b||this});return this},once:function(d,a,c){if(!ac(this,"once",d,[a,c])||!a){return this}var e=this;var b=N.once(function(){e.off(d,b);a.apply(this,arguments)});b._callback=a;return this.on(d,b,c)},off:function(k,b,j){var d,c,a,e,f,i,g,h;if(!this._events||!ac(this,"off",k,[b,j])){return this}if(!k&&!b&&!j){this._events=void 0;return this}e=k?[k]:N.keys(this._events);for(f=0,i=e.length;f<i;f++){k=e[f];if(a=this._events[k]){this._events[k]=d=[];if(b||j){for(g=0,h=a.length;g<h;g++){c=a[g];if((b&&b!==c.callback&&b!==c.callback._callback)||(j&&j!==c.context)){d.push(c)}}}if(!d.length){delete this._events[k]}}}return this},trigger:function(b){if(!this._events){return this}var c=al.call(arguments,1);if(!ac(this,"trigger",b,c)){return this}var a=this._events[b];var d=this._events.all;if(a){az(a,c)}if(d){az(d,arguments)}return this},stopListening:function(c,e,a){var d=this._listeningTo;if(!d){return this}var f=!e&&!a;if(!a&&typeof e==="object"){a=this}if(c){(d={})[c._listenId]=c}for(var b in d){c=d[b];c.off(e,a,this);if(f||N.isEmpty(c._events)){delete this._listeningTo[b]}}return this}};var ad=/\s+/;var ac=function(a,c,g,d){if(!g){return true}if(typeof g==="object"){for(var e in g){a[c].apply(a,[e,g[e]].concat(d))}return false}if(ad.test(g)){var b=g.split(ad);for(var f=0,h=b.length;f<h;f++){a[c].apply(a,[b[f]].concat(d))}return false}return true};var az=function(c,e){var b,d=-1,f=c.length,g=e[0],h=e[1],a=e[2];switch(e.length){case 0:while(++d<f){(b=c[d]).callback.call(b.ctx)}return;case 1:while(++d<f){(b=c[d]).callback.call(b.ctx,g)}return;case 2:while(++d<f){(b=c[d]).callback.call(b.ctx,g,h)}return;case 3:while(++d<f){(b=c[d]).callback.call(b.ctx,g,h,a)}return;default:while(++d<f){(b=c[d]).callback.apply(b.ctx,e)}return}};var W={listenTo:"on",listenToOnce:"once"};N.each(W,function(b,a){P[a]=function(e,g,c){var f=this._listeningTo||(this._listeningTo={});var d=e._listenId||(e._listenId=N.uniqueId("l"));f[d]=e;if(!c&&typeof g==="object"){c=this}e[b](g,c,this);return this}});P.bind=P.on;P.unbind=P.off;N.extend(Z,P);var U=Z.Model=function(c,a){var b=c||{};a||(a={});this.cid=N.uniqueId("c");this.attributes={};if(a.collection){this.collection=a.collection}if(a.parse){b=this.parse(b,a)||{}}b=N.defaults({},b,N.result(this,"defaults"));this.set(b,a);this.changed={};this.initialize.apply(this,arguments)};N.extend(U.prototype,P,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return N.clone(this.attributes)},sync:function(){return Z.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return N.escape(this.get(a))},has:function(a){return this.get(a)!=null},set:function(e,m,a){var g,d,c,f,h,b,k,i;if(e==null){return this}if(typeof e==="object"){d=e;a=m}else{(d={})[e]=m}a||(a={});if(!this._validate(d,a)){return false}c=a.unset;h=a.silent;f=[];b=this._changing;this._changing=true;if(!b){this.changed={}}i=this.attributes,k=this.attributes;if(this.idAttribute in d){this.previousId=this.id;this.id=d[this.idAttribute]}for(g in d){m=d[g];if(i[g]!==m){f.push(g)}if(k[g]!==m){this.changed[g]=m}else{delete this.changed[g]}c?delete i[g]:i[g]=m}if(!h){if(f.length){this._pending=a}for(var j=0,l=f.length;j<l;j++){this.trigger("change:"+f[j],this,i[f[j]],a)}}if(b){return this}if(!h){while(this._pending){a=this._pending;this._pending=false;this.trigger("change",this,a)}}this._pending=false;this._changing=false;return this},unset:function(b,a){return this.set(b,void 0,N.extend({},a,{unset:true}))},clear:function(b){var c={};for(var a in this.attributes){c[a]=void 0}return this.set(c,N.extend({},b,{unset:true}))},hasChanged:function(a){if(a==null){return !N.isEmpty(this.changed)}return N.has(this.changed,a)},changedAttributes:function(c){if(!c){return this.hasChanged()?this.changed:false}var a,b=false;for(var d in c){a=c[d];if(this.attributes[d]===a&&!(d in this.changed)){continue}(b||(b={}))[d]=a}return b},fetch:function(b){b=b?N.clone(b):{};if(b.parse===void 0){b.parse=true}var c=this;var a=b.success;b.success=function(d){if(!c.set(c.parse(d,b),b)){return false}if(a){a(c,d,b)}c.trigger("sync",c,d,b)};R(this,b);return this.sync("read",this,b)},save:function(e,h,a){var d,i,b,g=this.attributes;if(e==null||typeof e==="object"){d=e;a=h}else{(d={})[e]=h}a=N.extend({validate:true},a);if(d&&!a.wait){if(!this.set(d,a)){return false}}else{if(!this._validate(d,a)){return false}}if(d&&a.wait){this.attributes=N.extend({},g,d)}if(a.parse===void 0){a.parse=true}var f=this;var c=a.success;a.success=function(k){f.attributes=g;var j=f.parse(k,a);if(a.wait){j=N.extend(d||{},j)}if(N.isObject(j)&&!f.set(j,a)){return false}if(c){c(f,k,a)}f.trigger("sync",f,k,a)};R(this,a);i=this.isNew()?"create":(a.patch?"patch":"update");if(i==="patch"){a.attrs=d}b=this.sync(i,this,a);if(d&&a.wait){this.attributes=g}return b},destroy:function(d){d=d?N.clone(d):{};var e=this;var a=d.success;var c=function(){e.trigger("destroy",e,e.collection,d)};d.success=function(f){if(d.wait||e.isNew()){c()}if(a){a(e,f,d)}if(!e.isNew()){e.trigger("sync",e,f,d)}};if(this.isNew()){d.success();return false}R(this,d);var b=this.sync("delete",this,d);if(!d.wait){c()}return b},url:function(){var a=N.result(this,"urlRoot")||N.result(this.collection,"url")||ai();if(this.isNew()){return a}return a.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return !this.has(this.idAttribute)},isValid:function(a){return this._validate({},N.extend(a||{},{validate:true}))},_validate:function(a,b){if(!b.validate||!this.validate){return true}a=N.extend({},this.attributes,a);var c=this.validationError=this.validate(a,b)||null;if(!c){return true}this.trigger("invalid",this,c,N.extend(b,{validationError:c}));return false}});var aA=["keys","values","pairs","invert","pick","omit"];N.each(aA,function(a){U.prototype[a]=function(){var b=al.call(arguments);b.unshift(this.attributes);return N[a].apply(N,b)}});var ay=Z.Collection=function(a,b){b||(b={});if(b.model){this.model=b.model}if(b.comparator!==void 0){this.comparator=b.comparator}this._reset();this.initialize.apply(this,arguments);if(a){this.reset(a,N.extend({silent:true},b))}};var O={add:true,remove:false};N.extend(ay.prototype,P,{model:U,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return Z.sync.apply(this,arguments)},add:function(a,b){return this.set(a,N.extend({merge:false},b,O))},remove:function(a,d){var b=!N.isArray(a);a=b?[a]:N.clone(a);d||(d={});var c,g,e,f;for(c=0,g=a.length;c<g;c++){f=a[c]=this.get(a[c]);if(!f){continue}delete this._byId[f.id];delete this._byId[f.cid];e=this.indexOf(f);this.models.splice(e,1);this.length--;if(!d.silent){d.index=e;f.trigger("remove",f,this,d)}this._removeReference(f,d)}return b?a[0]:a},set:function(p,l){l=N.extend({add:true,remove:true,merge:true},l);if(l.parse){p=this.parse(p,l)}var i=!N.isArray(p);p=i?(p?[p]:[]):N.clone(p);var t,v,d,k,b,e,q;var g=l.at;var r=this.model;var m=this.comparator&&(g==null)&&l.sort!==false;var s=N.isString(this.comparator)?this.comparator:null;var n=[],a=[],c={};var f=l.add,j=l.merge,o=l.remove;var u=!m&&f&&o?[]:false;for(t=0,v=p.length;t<v;t++){b=p[t]||{};if(b instanceof U){d=k=b}else{d=b[r.prototype.idAttribute||"id"]}if(e=this.get(d)){if(o){c[e.cid]=true}if(j){b=b===k?k.attributes:b;if(l.parse){b=e.parse(b,l)}e.set(b,l);if(m&&!q&&e.hasChanged(s)){q=true}}p[t]=e}else{if(f){k=p[t]=this._prepareModel(b,l);if(!k){continue}n.push(k);this._addReference(k,l)}}k=e||k;if(u&&(k.isNew()||!c[k.id])){u.push(k)}c[k.id]=true}if(o){for(t=0,v=this.length;t<v;++t){if(!c[(k=this.models[t]).cid]){a.push(k)}}if(a.length){this.remove(a,l)}}if(n.length||(u&&u.length)){if(m){q=true}this.length+=n.length;if(g!=null){for(t=0,v=n.length;t<v;t++){this.models.splice(g+t,0,n[t])}}else{if(u){this.models.length=0}var h=u||n;for(t=0,v=h.length;t<v;t++){this.models.push(h[t])}}}if(q){this.sort({silent:true})}if(!l.silent){for(t=0,v=n.length;t<v;t++){(k=n[t]).trigger("add",k,this,l)}if(q||(u&&u.length)){this.trigger("sort",this,l)}}return i?p[0]:p},reset:function(a,c){c||(c={});for(var b=0,d=this.models.length;b<d;b++){this._removeReference(this.models[b],c)}c.previousModels=this.models;this._reset();a=this.add(a,N.extend({silent:true},c));if(!c.silent){this.trigger("reset",this,c)}return a},push:function(a,b){return this.add(a,N.extend({at:this.length},b))},pop:function(a){var b=this.at(this.length-1);this.remove(b,a);return b},unshift:function(a,b){return this.add(a,N.extend({at:0},b))},shift:function(a){var b=this.at(0);this.remove(b,a);return b},slice:function(){return al.apply(this.models,arguments)},get:function(a){if(a==null){return void 0}return this._byId[a]||this._byId[a.id]||this._byId[a.cid]},at:function(a){return this.models[a]},where:function(b,a){if(N.isEmpty(b)){return a?void 0:[]}return this[a?"find":"filter"](function(d){for(var c in b){if(b[c]!==d.get(c)){return false}}return true})},findWhere:function(a){return this.where(a,true)},sort:function(a){if(!this.comparator){throw new Error("Cannot sort a set without a comparator")}a||(a={});if(N.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(N.bind(this.comparator,this))}if(!a.silent){this.trigger("sort",this,a)}return this},pluck:function(a){return N.invoke(this.models,"get",a)},fetch:function(c){c=c?N.clone(c):{};if(c.parse===void 0){c.parse=true}var a=c.success;var b=this;c.success=function(e){var d=c.reset?"reset":"set";b[d](e,c);if(a){a(b,e,c)}b.trigger("sync",b,e,c)};R(this,c);return this.sync("read",this,c)},create:function(c,d){d=d?N.clone(d):{};if(!(c=this._prepareModel(c,d))){return false}if(!d.wait){this.add(c,d)}var a=this;var b=d.success;d.success=function(f,e){if(d.wait){a.add(f,d)}if(b){b(f,e,d)}};c.save(null,d);return c},parse:function(a,b){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(a,b){if(a instanceof U){return a}b=b?N.clone(b):{};b.collection=this;var c=new this.model(a,b);if(!c.validationError){return c}this.trigger("invalid",this,c.validationError,b);return false},_addReference:function(a,b){this._byId[a.cid]=a;if(a.id!=null){this._byId[a.id]=a}if(!a.collection){a.collection=this}a.on("all",this._onModelEvent,this)},_removeReference:function(a,b){if(this===a.collection){delete a.collection}a.off("all",this._onModelEvent,this)},_onModelEvent:function(b,c,a,d){if((b==="add"||b==="remove")&&a!==this){return}if(b==="destroy"){this.remove(c,d)}if(c&&b==="change:"+c.idAttribute){delete this._byId[c.previousId];if(c.id!=null){this._byId[c.id]=c}}this.trigger.apply(this,arguments)}});var aa=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];N.each(aa,function(a){ay.prototype[a]=function(){var b=al.call(arguments);b.unshift(this.models);return N[a].apply(N,b)}});var ao=["groupBy","countBy","sortBy","indexBy"];N.each(ao,function(a){ay.prototype[a]=function(b,d){var c=N.isFunction(b)?b:function(e){return e.get(b)};return N[a](this.models,c,d)}});var S=Z.View=function(a){this.cid=N.uniqueId("view");a||(a={});N.extend(this,N.pick(a,aw));this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var ae=/^(\S+)\s*(.*)$/;var aw=["model","collection","el","id","attributes","className","tagName","events"];N.extend(S.prototype,P,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(b,a){if(this.$el){this.undelegateEvents()}this.$el=b instanceof Z.$?b:Z.$(b);this.el=this.$el[0];if(a!==false){this.delegateEvents()}return this},delegateEvents:function(b){if(!(b||(b=N.result(this,"events")))){return this}this.undelegateEvents();for(var c in b){var a=b[c];if(!N.isFunction(a)){a=this[b[c]]}if(!a){continue}var d=c.match(ae);var e=d[1],f=d[2];a=N.bind(a,this);e+=".delegateEvents"+this.cid;if(f===""){this.$el.on(e,a)}else{this.$el.on(e,f,a)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid);return this},_ensureElement:function(){if(!this.el){var b=N.extend({},N.result(this,"attributes"));if(this.id){b.id=N.result(this,"id")}if(this.className){b["class"]=N.result(this,"className")}var a=Z.$("<"+N.result(this,"tagName")+">").attr(b);this.setElement(a,false)}else{this.setElement(N.result(this,"el"),false)}}});Z.sync=function(a,f,g){var d=ap[a];N.defaults(g||(g={}),{emulateHTTP:Z.emulateHTTP,emulateJSON:Z.emulateJSON});var b={type:d,dataType:"json"};if(!g.url){b.url=N.result(f,"url")||ai()}if(g.data==null&&f&&(a==="create"||a==="update"||a==="patch")){b.contentType="application/json";b.data=JSON.stringify(g.attrs||f.toJSON(g))}if(g.emulateJSON){b.contentType="application/x-www-form-urlencoded";b.data=b.data?{model:b.data}:{}}if(g.emulateHTTP&&(d==="PUT"||d==="DELETE"||d==="PATCH")){b.type="POST";if(g.emulateJSON){b.data._method=d}var e=g.beforeSend;g.beforeSend=function(h){h.setRequestHeader("X-HTTP-Method-Override",d);if(e){return e.apply(this,arguments)}}}if(b.type!=="GET"&&!g.emulateJSON){b.processData=false}if(b.type==="PATCH"&&aq){b.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}var c=g.xhr=Z.ajax(N.extend(b,g));f.trigger("request",f,c,g);return c};var aq=typeof window!=="undefined"&&!!window.ActiveXObject&&!(window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent);var ap={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};Z.ajax=function(){return Z.$.ajax.apply(Z.$,arguments)};var ak=Z.Router=function(a){a||(a={});if(a.routes){this.routes=a.routes}this._bindRoutes();this.initialize.apply(this,arguments)};var aj=/\((.*?)\)/g;var ah=/(\(\?)?:\w+/g;var ax=/\*\w+/g;var at=/[\-{}\[\]+?.,\\\^$|#\s]/g;N.extend(ak.prototype,P,{initialize:function(){},route:function(c,b,a){if(!N.isRegExp(c)){c=this._routeToRegExp(c)}if(N.isFunction(b)){a=b;b=""}if(!a){a=this[b]}var d=this;Z.history.route(c,function(i){var j=d._extractParameters(c,i);j[0]=i;var h=i.match(T);var e=h?h[0].replace("#",""):null;var f=j.length-2;var k=j[f];j[f]=k?k.replace(T,""):null;var g=N.last(j);j[j.length-1]=g?g.replace(T,""):null;j.push(e);d.execute(a,j);d.trigger.apply(d,["route:"+b].concat(j));d.trigger("route",b,j);Z.history.trigger("route",d,b,j)});return this},execute:function(a,b){if(a){a.apply(this,b)}},navigate:function(a,b){Z.history.navigate(a,b);return this},_bindRoutes:function(){if(!this.routes){return}this.routes=N.result(this,"routes");var a,b=N.keys(this.routes);while((a=b.pop())!=null){this.route(a,this.routes[a])}},_routeToRegExp:function(a){a=a.replace(at,"\\$&").replace(aj,"(?:$1)?").replace(ah,function(b,c){return c?b:"([^/?]+)"}).replace(ax,"([^?]*?)");return new RegExp("^"+a+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(c,b){var a=c.exec(b).slice(1);return N.map(a,function(d,e){if(e===a.length-1){return d||null}return d?decodeURIComponent(d):null})}});var ar=Z.History=function(){this.handlers=[];N.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var Y=/^[#\/]|\s+$/g;var av=/^\/+|\/+$/g;var Q=/msie [\w.]+/;var am=/\/$/;var T=/#.*$/;ar.started=false;N.extend(ar.prototype,P,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(a,b){if(a==null){if(this._hasPushState||!this._wantsHashChange||b){a=decodeURI(this.location.pathname+this.location.search+this.location.hash);var c=this.root.replace(am,"");if(!a.indexOf(c)){a=a.slice(c.length)}}else{a=this.getHash()}}return a.replace(Y,"")},start:function(d){if(ar.started){throw new Error("Backbone.history has already been started")}ar.started=true;this.options=N.extend({root:"/"},this.options,d);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var e=this.getFragment();var f=document.documentMode;var c=(Q.exec(navigator.userAgent.toLowerCase())&&(!f||f<=7));this.root=("/"+this.root+"/").replace(av,"/");if(c&&this._wantsHashChange){var a=Z.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=a.hide().appendTo("body")[0].contentWindow;this.navigate(e)}if(this._hasPushState){Z.$(window).on("popstate",this.checkUrl)}else{if(this._wantsHashChange&&("onhashchange" in window)&&!c){Z.$(window).on("hashchange",this.checkUrl)}else{if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}}}this.fragment=e;var b=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&(!this.atRoot()||this.location.search)){this.fragment=this.getFragment(null,true);this.location.replace(this.root+"#"+this.fragment);return true}else{if(this._hasPushState&&this.atRoot()&&b.hash){this.fragment=this.getHash().replace(Y,"");this.history.replaceState({},document.title,this.root+this.fragment)}}}if(!this.options.silent){return this.loadUrl()}},stop:function(){Z.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);if(this._checkUrlInterval){clearInterval(this._checkUrlInterval)}ar.started=false},route:function(b,a){this.handlers.unshift({route:b,callback:a})},checkUrl:function(a){var b=this.getFragment();if(b===this.fragment&&this.iframe){b=this.getFragment(this.getHash(this.iframe))}var c=b.replace(T,"");var d=this.fragment?this.fragment.replace(T,""):null;if(b===this.fragment){return false}if(this.iframe){this.navigate(b)}if(c!==d){this.loadUrl()}},loadUrl:function(a){a=this.fragment=this.getFragment(a);return N.any(this.handlers,function(b){if(b.route.test(a)){b.callback(a);return true}})},navigate:function(c,d){if(!ar.started){return false}if(!d||d===true){d={trigger:!!d}}var b=c.match(T);var a=b?b[0]:"";var e=this.root+(c=this.getFragment(c||""));var f=this.fragment?this.fragment.replace(T,""):this.fragment;if(this.fragment===c){return}this.fragment=c;if(c===""&&e!=="/"){e=e.slice(0,-1)}if(this._hasPushState){this.history[d.replace?"replaceState":"pushState"]({},document.title,e)}else{if(this._wantsHashChange){this._updateHash(this.location,c,d.replace);if(this.iframe&&(c!==this.getFragment(this.getHash(this.iframe)))){if(!d.replace){this.iframe.document.open().close()}this._updateHash(this.iframe.location,c,d.replace)}}else{return this.location.assign(e)}}if(d.trigger&&f!==c){return this.loadUrl(c)}},_updateHash:function(d,b,a){if(a){var c=d.href.replace(/(javascript:|#).*$/,"");d.replace(c+"#"+b)}else{d.hash="#"+b}}});Z.history=new ar;var an=function(e,c){var d=this;var a;if(e&&N.has(e,"constructor")){a=e.constructor}else{a=function(){return d.apply(this,arguments)}}N.extend(a,d,c);var b=function(){this.constructor=a};b.prototype=d.prototype;a.prototype=new b;if(e){N.extend(a.prototype,e)}a.__super__=d.prototype;return a};U.extend=ay.extend=ak.extend=S.extend=ar.extend=an;var ai=function(){throw new Error('A "url" property or function must be specified')};var R=function(a,b){var c=b.error;b.error=function(d){if(c){c(a,d,b)}a.trigger("error",a,d,b)}};return Z}));if(typeof window.localStorage=="undefined"||typeof window.sessionStorage=="undefined"){(function(){var b=function(k){function l(e,d,c){var f,g;if(c){f=new Date();f.setTime(f.getTime()+(c*24*60*60*1000));g="; expires="+f.toGMTString()}else{g=""}document.cookie=e+"="+d+g+"; path=/"}function i(e){var c=e+"=",f=document.cookie.split(";"),d,g;for(d=0;d<f.length;d++){g=f[d];while(g.charAt(0)==" "){g=g.substring(1,g.length)}if(g.indexOf(c)==0){return g.substring(c.length,g.length)}}return null}function m(c){c=JSON.stringify(c);if(k=="session"){window.name=c}else{l("localStorage",c,365)}}function n(){if(k=="session"){window.name=""}else{l("localStorage","",365)}}function a(){var c=k=="session"?window.name:i("localStorage");return c?JSON.parse(c):{}}var j=a();return{length:0,clear:function(){j={};this.length=0;n()},getItem:function(c){return j[c]===undefined?null:j[c]},key:function(d){var c=0;for(var e in j){if(c==d){return e}else{c++}}return null},removeItem:function(c){delete j[c];this.length--;m(j)},setItem:function(d,c){j[d]=c+"";this.length++;m(j)}}};if(typeof window.localStorage=="undefined"){window.localStorage=new b("local")}if(typeof window.sessionStorage=="undefined"){window.sessionStorage=new b("session")}})()}define("vendor/sessionStorage/sessionStorage",function(){});define("models/session",["require","exports","module","backbone","vendor/sessionStorage/sessionStorage"],function(p,i,n){p("backbone");p("vendor/sessionStorage/sessionStorage");if(!sessionStorage.getItem("buzz")){sessionStorage.setItem("buzz",JSON.stringify({}))}var m=JSON.parse(sessionStorage.getItem("buzz")),j=m.locale||navigator.language||navigator.userLanguage||"en-us",l=JSON.parse(sessionStorage.getItem("buzz-user-"+m.interfaceId));requirejs.config({locale:j});var k={defaults:function(){return _.defaults(m,l,{sid:"",access_token:"",token_type:"",expires_in:"",client_create_time:"",user_number:null,locale:j.toLowerCase(),refresh_token:"",legacyEhostOrigin:"",interfaceId:"",profileId:"",webAuthOrigin:"",redirectOnSessionExpire:false,notify_trial_cust:false,referrer_token:"",nrfInfo:"",mode:"default"})},initialize:function(a){if(this.query&&this.query.length){o(this)}_.bindAll(this,"renewSession","logActivity")},validateUserNumber:function(a){if(this.has("user_number")&&(this.get("user_number")+"")!=(a+"")){return this.renewSession()}},validateLocale:function(a){if(this.has("locale")&&this.get("locale")!==a){this.set("locale",a)}},set:function(c,a){var b={};if(_.isObject(c)){b=c}else{b[c]=a}b=_.pick(b,"sid","client_create_time","user_number","access_token","locale","refresh_token","token_type","expires_in","legacyEhostOrigin","interfaceId","profileId","webAuthOrigin","redirectOnSessionExpire","mode","notify_trial_cust","referrer_token","nrfInfo");if(null===b.sid){delete b.sid}if(b.expires_in!==null&&!_.isEmpty(b.expires_in)){if(!b.client_create_time){b.client_create_time=new Date().getTime()}}else{delete b.client_create_time}Backbone.Model.prototype.set.apply(this,[b]);this.save()},save:function(){sessionStorage.setItem("buzz",JSON.stringify(this.attributes))},newSet:function(a){_.extend(this.attributes,a)},newSave:function(){sessionStorage.setItem("buzz-user-"+this.get("interfaceId"),JSON.stringify(this.pick("mode")))},startPrerenderSession:function(){var d={async:false,contentType:"application/json; charset=utf-8"},c=this.get("legacyEhostOrigin").replace("http:","https:"),b=this.get("interfaceId"),a="LoginAndCreateSession/v1?role=WebCrawler";this.url=[c,b,a].join("/");if(!(this.tokenPromise&&this.tokenPromise.state()!=="resolved")){this.tokenPromise=Backbone.Model.prototype.fetch.apply(this,[d]);this.tokenPromise.done(_.bind(this.onRenewComplete,this)).fail(_.bind(this.onSessionFail,this))}else{}return this.tokenPromise},startSession:function(){if(this.sessionTimeout){clearTimeout(this.sessionTimeout)}if(!this.testEhostSession()){this.onSessionFail()}this.lastUserActivity=new Date().getTime();this.autoRenew=true;var a=parseInt(this.get("client_create_time"),10),b=this.getExpirationMs(),c=this.lastUserActivity-a;if(c>=b){this.renewSession()}else{this.sessionTimeout=setTimeout(_.bind(this.renewSessionTimeout,this),b-c)}},getExpirationMs:function(){var c=this.get("expires_in")||"2m",d=parseInt(c,10),b,a=1000;if(c.indexOf("m")>=0){a*=60}else{if(c.indexOf("h")>=0){a*=3600}}d=(d*=a);b=Math.round(d/10);return d-b},renewSessionTimeout:function(){var a=new Date().getTime();if((a-this.lastUserActivity)<this.getExpirationMs()){this.renewSession()}else{this.autoRenew=false}},renewSession:function(){var a=(this.has("access_token")&&(this.get("sid").length)&&(this.get("refresh_token").length)&&(this.get("interfaceId").length));if(a){return this.fetch()}return $.Deferred().reject().promise()},logActivity:function(){this.lastUserActivity=new Date().getTime();if(!this.autoRenew){this.startSession()}},fetch:function(a){if(!(this.tokenPromise&&this.tokenPromise.state()!=="resolved")){if(this.get("legacyEhostOrigin")&&this.get("interfaceId")){this.url=a&&a.url?a.url:this.get("legacyEhostOrigin")+"/"+this.get("interfaceId")+"/AccessToken/v4"}else{this.url=ep.utilities.getBaseRequestPath()+"/AccessToken/v4"}if(this.has("sid")){this.url+="?sid="+this.get("sid")}a=a||{};a.type="POST";a.data=JSON.stringify({grant_type:"refresh_token",refresh_token:this.get("refresh_token")});a.contentType="application/json; charset=utf-8";this.tokenPromise=Backbone.Model.prototype.fetch.apply(this,arguments.length?arguments:[a]);this.tokenPromise.done(_.bind(this.onRenewComplete,this)).fail(_.bind(this.onSessionFail,this))}else{}return this.tokenPromise},onRenewComplete:function(b,a,c){var d=/json/ig.test(c.getResponseHeader("Content-Type"));if(c.status===401||a==="error"||!d){return $.Deferred().reject(c,b).promise()}this.startSession()},onSessionFail:function(){this.unset("access_token")},testEhostSession:function(){return !!(this.get("sid")&&this.get("sid").length)}};n.exports=Backbone.Model.extend(k);function o(a){Backbone.Router.extend({navigate:function(c,d){var b={};_.each(a.attributes,function(f,e){if(a.query.indexOf(e)>-1){b[e]=f}});c=this.toFragment(c,b);Backbone.history.navigate(c,d);return this}})}});define("session.ehost",["require","exports","module","models/session"],function(g,h,l){var i=g("models/session"),k=JSON.parse(sessionStorage.getItem("buzz")),j=new i(k);l.exports=j});require(["session.ehost"]);(function(d){var f=require("session.ehost");if(ep.locale){f.validateLocale(ep.locale)}if(ep.clientData.usrNo){f.validateUserNumber(ep.clientData.usrNo)}f.startSession();var e=_.debounce(function(){f.logActivity()},500);d(window).on("resize",e);d("html").on("mousemove click keyup",e)})(jQuery);(function(){var j=window.jQuery,i=require("session.ehost");if(ep.clientData.ebookViewer){ep.require("ep/utilities.js")}var g=function(){ep.require("ep/widgets/epmodal.js",function(a){j(document).epmodal({url:"EbookViewer/TokenAuthenticationModal",zIndex:10010})})};var h=function(a){if(a.responseText!=" "){window.location=a.responseText}else{g()}};var f=function(a){var c={},b=a.split("&"),e;for(var d=0;d<b.length;d++){e=b[d].split("=");c[e[0]]=e[1]}return c};if(!!f(window.location.search).detailAuthError===true){g()}j.ajaxPrefilter(function(c,a,b){var d=_.some(["CheckoutDialog/CheckBookAvailability","ebookViewer/DigitalObject","ebookviewer/download","ebookViewer/pageturnandrenew","ebookdelivery/printpdf","ebookdelivery/emailpdf","CheckoutDialog/TokenValidation"],function(e){return c.url.split("?")[0].indexOf(e)>=0});if(d){c.beforeSend=function(e){e.setRequestHeader("Authorization","Bearer "+i.get("access_token"))};if(!c.doNotRetry){b.fail(function(e){if(e.status===401){i.fetch().done(function(){j.ajax(_.extend({doNotRetry:true},c)).fail(h)}).fail(function(){if(ep.clientData.ebookViewer){window.location=ep.utilities.buildAjaxRequestPathWithExistingReturn("detail/detail",ep.clientData.currentRecord)+"&detailAuthError=true"}else{g()}})}})}}})})();