(function(s){var v=null;var y=ep.clientData.rtacTimeout+5;var q="summary";var x=15;function p(){if(ep.clientData.rtacView){q=ep.clientData.rtacView}var a=s("[data-rtac]");if(a.length){o(a)}s("#mainContentArea").delegate(".rtac-link","click",function(b){b.preventDefault();o(s(b.currentTarget));s(b.currentTarget).removeClass("rtac-link")});ep.subscribe("moreResultsLoaded",function(c){var b=c.find("[data-rtac]");if(b.length){o(b)}},true)}function o(c){var b=[];c.each(function(e,d){b.push(s(d).data("rtac"))});c.addClass("loading");var a=c.first().data("rtacerror");s.ajax({url:ep.utilities.buildAjaxRequestPath("RealTimeAvailability/"+q,q==="detail"?ep.clientData.currentRecord:null),type:"POST",data:ep.util.JSON.stringify({rtacData:b}),contentType:"application/json; charset=utf-8",context:c,timeout:y*1000,error:function(f,e,d){z(this,a,c)},statusCode:{204:function(f,e,d){z(this,a,c)}},success:function(d,f,e){if(e.status!==204){w(d,c);n(this);c.removeClass("loading");r(c)}}})}function r(a){a.each(function(){if(s(this).find(".rtac-empty").length){s(this).closest(".rtac.toggle-container").hide()}})}function w(a,c){var b=s("<div>").html(a).find("[id^='rtac_']");if(!b.length){r(c);return}b.each(function(f,d){var e=s(d);var g=s("#"+e.attr("id"));if(g.length){g.removeClass("loading");g.first().html(e.html())}})}function z(b,a,c){b.removeClass("loading");if(a){b.replaceWith(a)}r(c);if(q==="detail"){n(b)}}function n(a){if(q==="summary"){s(a).each(s.proxy(function(d,c){var b=s(c).find("a.rtac-citation-link").first();if(b.length){b.click(s.proxy(u,this))}},this))}if(q==="detail"||q==="summary"){s(a).each(s.proxy(function(c,b){var d=s("#rtac_"+s(b).data("rtac").RecordAN);if(d.length){b=d}s(b).click(s.proxy(t,this))},this))}s(".rtac.treelist-heading").on("click",function(b){b.preventDefault();s(this).toggleClass("expanded")})}function u(b){b.preventDefault();var c=s(b.target).parents(".result-list-record").find("a[id^='Result_']").first();var e=s(b.target).closest(".rtac, .rtac-item").prop("id");if(ep.clientData.isMobile){var h=s(b.target).closest(".record-info").find(".record-title a").prop("href");window.location.href=h.indexOf("#")!==-1?h:h+"#"+e}else{if(c.length){var g=c.attr("onclick");if(g){try{if(g.startsWith("function")){g=g.substring(g.indexOf("{")+1,g.lastIndexOf("}"))}var a=g.substring(g.indexOf("(")+1,g.lastIndexOf(")")).split(",");for(var f=0;f<3;f++){a[f]=a[f].substring(a[f].indexOf("'")+1,a[f].lastIndexOf("'"))}a[1]=a[1]+"||scrollTo~~"+e;__doLinkPostBack(a[0],a[1],a[2])}catch(d){c.onclick()}}}}return false}function t(a){var b=s(a.target);var d=b.closest("[id^='rtac_']").first();var c=d.find("tbody").children();if(b.is("a.rtac-show-all")){a.preventDefault();c.not(".sel-rtac-first").toggle()}else{if(b.is("a.rtac-show-less")){a.preventDefault();var e=c.length;c.not(".sel-rtac-first").toggle();if(e>=x){d.scrollTo()}}}}s(p)})(jQuery);