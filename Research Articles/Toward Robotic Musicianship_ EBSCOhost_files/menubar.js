var KEY_SPACE=32;var KEY_INSERT=45;if(!ep.menu){ep.menu={}}ep.menu.InitializeMenubar=function(c){if((navigator.appName.toLowerCase().indexOf("explorer")!==-1)&&(navigator.userAgent.toLowerCase().indexOf("msie 6")!==-1)){ep.menu.isIE6=true}var d=jQuery("#"+c);if(d.length){d.attr("role","menubar");d.find('span[class != "hidden"]').attr({"aria-haspop":"true",tabIndex:-1});d.find("dt").each(function(f,a){a=jQuery(a);var b=a.parent("dl").first();if(b[0]!==d[0]){b.attr("role","menu");a.addClass(ep.menu.isIE6?"bg1":"bar4 submenu-link")}a.attr("role","menuitem");a.mouseover(function(){a.addClass("mouse-over")});a.mouseout(function(){a.removeClass("mouse-over")});if(a.next().length&&a.next().is("DD")){a.mouseover(function(e){ep.menu.OpenMenu(e.currentTarget,e)});a.next().mouseleave(function(e){ep.menu.CloseMenu(e.currentTarget,e)})}});d.find("a").keydown(ep.menu.MenuItemAction);d.find("dt.submenu-heading span").keydown(ep.menu.MenuItemAction);d.find("dt.toolbar-link").keydown(ep.menu.ToolbarAction);d.find("dt.first-item").keydown(ep.menu.ToolbarAction)}};ep.menu.ToolbarAction=function(j){var h=j.which;var k=jQuery.ui.keyCode;var l=jQuery(j.target);if(!l.is("DT")){l=l.parent("dt").first()}var m=l.parent("dd").length;if(h===k.ENTER||h===k.SPACE||h===k.UP||h===k.DOWN){if(l.next().is("DD")){ep.menu.OpenMenu(l,j)}}else{if(h===k.LEFT||h===k.RIGHT){ep.menu.CloseMenu();j.preventDefault();var n;if(l.is("DT")){n=l}else{n=l.parent("dt").first()}var i;if(h===k.LEFT){i=n.prev("dt");if(!i.length){i=n.parents("dl").first().children().last();if(!i.is("DT")){i=i.prev("dt")}}}else{i=n.next("dt");if(!i.length){i=n.parents("dl").first().children().first()}}if(i.length){i.children().first().focus()}}else{if(h===k.ESCAPE){if(ep.menu.activeMenu){jQuery(ep.menu.activeMenu).prev().children().first().focus()}ep.menu.CloseMenu();j.preventDefault()}}}};ep.menu.MenuItemAction=function(o){var m=o.which;var l=jQuery.ui.keyCode;var n=jQuery(o.target).parent("dt").first();if(m===l.RIGHT||m===l.SPACE){var t=n.next();if(m===l.RIGHT&&t.length&&t.is("DD")){ep.menu.OpenMenu(n,o)}else{var r;if(ep.menu.activeMenu){r=jQuery(ep.menu.activeMenu).prev()}else{if(m===l.RIGHT){r=n}}var q=jQuery(r).next("dt");if(!q.length){q=r.parent().children().first()}if(q.length){q.children().first().focus();o.preventDefault()}ep.menu.CloseMenu()}}else{if(m===l.UP){var k=n.prev("dt");if(!k.length){k=n.parents("dl").first().children().last();if(!k.is("DT")){k=k.prev("dt")}}k.children().first().focus();o.preventDefault()}else{if(m===l.DOWN){var s=n.next("dt");if(!s.length){s=n.parents("dl").first().children().first()}s.children().first().focus();o.preventDefault()}else{if(m===l.ESCAPE||m===l.LEFT){if(ep.menu.activeMenu&&ep.menu.activeMenu.activeSubMenu){jQuery(ep.menu.activeMenu.activeSubMenu).prev("dt").children().first().focus();jQuery(ep.menu.activeMenu.activeSubMenu).hide();ep.menu.activeMenu.activeSubMenu=null}else{var p;if(ep.menu.activeMenu){p=jQuery(ep.menu.activeMenu).prev("dt");ep.menu.CloseMenu()}else{p=n}if(m===l.LEFT){if(p.prev("dt").length){p=p.prev("dt")}else{p=n.parents("dl").first().children().last();if(!p.is("DT")){p=p.prev("dt")}}}p.children().first().focus()}o.preventDefault()}}}}};ep.menu.CancelClose=function(){ep.menu.ignoreClose=true};ep.menu.CloseMenu=function(){if(!ep.menu.ignoreClose){if(ep.menu.activeMenu){if(ep.menu.activeMenu.activeSubMenu){if(ep.menu.isIE6){ep.menu.cleanupIE6fix(ep.menu.activeMenu.activeSubMenu)}jQuery(ep.menu.activeMenu.activeSubMenu).hide();ep.menu.activeMenu.activeSubMenu=null}if(ep.menu.isIE6){ep.menu.cleanupIE6fix(ep.menu.activeMenu)}jQuery(ep.menu.activeMenu).hide();ep.menu.activeMenu=null}jQuery(document.body).unbind("click",ep.menu.CloseMenu)}else{ep.menu.ignoreClose=false}};ep.menu.OpenMenu=function(u,v){u=jQuery(u);var z=u.next();if(ep.menu.activeMenu&&u.parents().index(ep.menu.activeMenu)>=0){if(ep.menu.activeMenu.activeSubMenu){if(ep.menu.isIE6){ep.menu.cleanupIE6fix(ep.menu.activeMenu.activeSubMenu)}jQuery(ep.menu.activeMenu.activeSubMenu).hide()}ep.menu.activeMenu.activeSubMenu=z[0];var p=u.position();z.css({position:"absolute",top:p.top+"px",left:u.width()+1+"px"});if(ep.menu.isIE6){ep.menu.ApplyIE6MenuFix(z)}}else{if(ep.menu.activeMenu){jQuery(ep.menu.activeMenu).hide();if(ep.menu.activeMenu.activeSubMenu){if(ep.menu.isIE6){ep.menu.cleanupIE6fix(ep.menu.activeMenu.activeSubMenu)}jQuery(ep.menu.activeMenu.activeSubMenu).hide()}}ep.menu.activeMenu=z[0];var q=u.position();var w=q.left;var y=z.width();if(jQuery("#LanguageMenubar").length&&u.parents().index("LanguageMenubar")>=0){var x=q.left;var A=x+u.width();w=Math.floor(A-((A-x)/2)-(y/3));var B=jQuery("#outer-container, #outerContainer").first();if(B.length){var o=B.find(".toolbar").first();var s=o.width();var r=jQuery(window).width();var t=Math.max(r,s);if(t<(w+y)){w=t-y-5}}}z.css({position:"absolute",top:q.top+u.height()+4+"px",left:w+"px"});if(ep.menu.isIE6){ep.menu.ApplyIE6MenuFix(z)}}z.show();z.click(ep.menu.CancelClose);jQuery(document.body).click(ep.menu.CloseMenu);if(v){v.preventDefault();z.children("dt *").first().focus()}return false};ep.menu.ApplyIE6MenuFix=function(g){ep.ie6SelectFix();var j="menuIEFix";if(jQuery(g).parents("dd[@role='menu']").length){j+="_sub"}var h=jQuery("#"+j);var i=g.getDimensions();var k=jQuery(g).offset();if(!h.length){h=jQuery("<iframe/>").attr({id:j,scrolling:"no",frameBorder:"0"});var l=jQuery("#SearchNavigationMenubar, #LanguageMenubar");if(l.length){l.append(h)}}h.css({position:"absolute",width:i.width+2+"px",height:i.height+2+"px",top:k.top+"px",left:k.left+"px"})};ep.menu.cleanupIE6fix=function(d){ep.ie6SelectFix(true);var f="menuIEFix";if(d.parents("dd[@role='menu']").length){f+="_sub"}var e=jQuery("#"+f);if(e.length){e.remove();e=null}};ep.menu.OnResize=function(){var h=jQuery("#outer-container");if(!h.length){return}aMenuWidth=ep.menu.getMenuWidth(h);if(!aMenuWidth){return}var k=jQuery(document).width();var i=h.find(".toolbar").first();var j=h.find(".find-field-simple").first();var g=0;if(j.length){g=j.width()}var l=Math.max(g,aMenuWidth);if(l>k){i.width(l+10)}else{i.css({width:"100%"})}};ep.menu.getMenuWidth=function(c){var d=0;jQuery(c).find(".toolbar li, .authorities-menu-bar").each(function(){if(jQuery(this).css("display")==="block"){d=d+jQuery("#SearchNavigationMenubar").width()}else{d=d+jQuery(this).width()}});return d};ep.menu.init=function(){var b=jQuery("#SearchNavigationMenubar, #LanguageMenubar");if(b.length){ep.menu.InitializeMenubar("SearchNavigationMenubar")}if((b.length>1)||(b.selector.search("#LanguageMenubar"))){ep.menu.InitializeMenubar("LanguageMenubar")}jQuery(window).resize(ep.menu.OnResize)};ep.domLoad(ep.menu.init);(function(c){c(function(){c("body").delegate("dt.toolbar-link a[data-json],dt.submenu-link a[data-json]",{click:function(a){d.navigateToStartPageWithToolbar(a)},keypress:function(a){if(a.keyCode==="13"){d.navigateToStartPageWithToolbar(a)}}})});var d=function(){return{navigateToStartPageWithToolbar:function(a){var f=c(a.currentTarget).data("json");var b=ep.utilities.buildAjaxRequestPath("search/basic")+"&tid="+f.tid+"&sdb="+f.sdb;window.location.href=b;a.preventDefault()}}}()})(jQuery);