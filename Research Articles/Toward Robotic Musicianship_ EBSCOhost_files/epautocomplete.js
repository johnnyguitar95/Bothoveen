var ep = window.ep || {}; ep.bundles = ep.bundles || []; ep.bundles = ep.bundles.concat('bundled/epautocomplete.js','ep/widgets/epautocomplete/epautocomplete.js', 'ep/widgets/epautocomplete/epautocomplete-ehost.js');
(function(b){ep.require("ep/jqueryplugins/bididirfixer.js",function(){b.widget("ui.epautocomplete",{options:{data:{url:"autosuggest",termKey:"term",queryParams:{},massageData:false,searchOnSelect:false,highlightClass:null,truncateClass:"auto-complete-truncate",noWrapClass:"auto-complete-no-wrap",completions:{wrap:true,truncate:false,maxWidth:50},ajaxHandler:function(){},jQueryOverrides:{}}},_create:function(){var h=this,a=b(this.element),f=b.extend({},this.options.data),g=JSON.stringify;a.autocomplete(b.extend({source:function(c,d){f.queryParams[f.termKey]=c.term;b.each(f.queryParams,function(l,k){var e=this;if(b.isPlainObject(e)){f.queryParams[l]=g(e)}else{if(b.isArray(e)){f.queryParams[l]=g(e)}}});f.ajaxHandler.call(this,c,d,f.queryParams,function(e){var m=e.error;if(!m){h.curResponseData=e;if(f.massageData){var n=[];if(e.terms){if(f.displayGroups){b.each(f.displayGroups,function(i,k){var j=b.grep(e.terms,function(p){return k.idx===p.domain});if(j&&j.length){j.unshift({domain:k.idx,fragments:null,score:0,term:k.title,isHeader:true});n=b.merge(n,j)}})}else{n=e.terms}}var l=(function(){var i=[];if(e.terms){if(n&&n.length){i=b.map(n,function(j){return{value:j.term,fragments:j.fragments,domain:j.domain,isHeader:(j.isHeader)?true:false}})}else{i.push(e.terms.term)}}return i})();d(l)}else{d(e)}}})},open:function(e,d){var c=b(this),l=c.autocomplete("widget"),m={},n=f.completions;l.find("a").bidiDirFixer();b(this).bidiDirFixer();m.minWidth=c.innerWidth();l.addClass(f.highlightClass);if(n.truncate){m.maxWidth=n.maxWidth+"%"}if(!n.wrap){m.width="auto";l.addClass(f.noWrapClass)}if(b('html[dir="rtl"]').length>0){m.left="auto";m.right=(b(window).width()-(c.offset().left+c.outerWidth()))+"px"}l.css(m);if(b.browser.msie&&parseInt(b.browser.version,10)<8){l.width(l.width())}b(window).on("resize",function(){l.css(m)})},close:function(d,c){b(this).autocomplete("widget").removeClass(f.highlightClass)},select:function(d,c){if(f.onSelectCallback&&h.curResponseData.terms){var e;e=_.find(h.curResponseData.terms,function(j){return(j.term===c.item.value)});if(e){f.onSelectCallback({term:e.term,domain:e.domain,metadata:e.metadata})}}if(f.searchOnSelect){a.val(c.item.value);b("[id$='SearchButton']").click()}}},f.jQueryOverrides));a.data("autocomplete")._renderItem=function(e,c){var d=function(m){var n=(f.completions.truncate)?f.truncateClass:"";var i=b("<li></li>").data("item.autocomplete",c);if(c.isHeader){i.addClass("autocomplete-heading color-p2").html(m)}else{i.append(b("<a class='"+n+"'></a>").html(m))}return i.appendTo(e)};if(f.massageData){var j=function(){var l=c.fragments,i="";if(l){b.each(l,function(){var k=(f.highlightClass)?'<strong class="'+f.highlightClass+'">':"<strong>";if(this.user===true){i+=k+this.text+"</strong>"}else{i+=this.text}})}else{i=c.value}return i};return d(j())}else{return d(c.value)}}},_init:function(){},destroy:function(){b.Widget.prototype.destroy.call(this)}})})})(jQuery);(function(b){b(function(){ep.require("ep/widgets/epautocomplete/epautocomplete.js",function(){var h=8,g=10;function a(j,d){var e=b("[data-auto-complete]"),c=e.first().closest("form");e.each(function(){var m=b(this),i=(m.prop("tagName")==="INPUT")?m:m.find("input.auto-complete"),n;if(m.data("auto-complete")){n=b.extend(true,{},m.data("auto-complete"));if(j){n.queryParams.idx=j.queryParams.idx}n.handlePrototype=true;n.ajaxHandler=function(l,r,q,k){b.get(n.url,q,function(o){k(o)},"json")};if(d){i.epautocomplete("destroy")}n.onSelectCallback=function(l){var q=ep.searchInfoDetails||{type:"ACT",details:[]},k=q.details.length,r={term:l.term,d:l.domain};if(l.metadata){_.each(l.metadata.split(","),function(o,p){r["m"+p]=_.escape(o)})}q.details[k]=r;ep.searchInfoDetails=q};i.epautocomplete({data:n});m.data("auto-complete",n)}})}ep.subscribe("ep:autosuggest:limiter",function(e){var c=e.curSelected,d=ep.utilities.buildAjaxRequestPath("AutoComplete/GetSettings");if(c!==e.defaultId){b.ajax({url:d,data:{contentType:c},success:function(j){if(_.isString(j)){j=JSON.parse(j)}a(j,true)}})}else{a(null,true)}return false});function f(){try{a()}catch(c){if(--h){setTimeout(f,g);g*=2}}}f()})})})(jQuery);